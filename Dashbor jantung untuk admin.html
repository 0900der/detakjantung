<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚ù§Ô∏è HeartBeat Monitor</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #0a0a1a;
      --card: #1e1e30;
      --normal: #2ecc71;
      --warning: #f1c40f;
      --danger: #e74c3c;
      --text: #eee;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Poppins', sans-serif;
    }

    .card {
      background: var(--card);
      border-radius: 15px;
      border: 1px solid #333;
    }

    .pulse {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>

<body>

<nav class="navbar navbar-dark" style="background:#1e1e30;">
  <div class="container">
    <span class="navbar-brand">
      <i class="fas fa-heartbeat pulse"></i> HeartBeat Monitor
    </span>
  </div>
</nav>

<div class="container py-5 text-center">
  <h1>Monitoring Detak Jantung Real-Time</h1>
  <p class="opacity-75">Simulasi Sistem IoT Kesehatan</p>
</div>

<div class="container mb-5">
  <div class="row g-4">

    <!-- FORM PASIEN -->
    <div class="col-md-5">
      <div class="card p-4">
        <h5><i class="fas fa-user-plus"></i> Tambah Pasien</h5>
        <form onsubmit="addPatient(event)">
          <input id="name" class="form-control mb-2" placeholder="Nama" required>
          <input id="pid" class="form-control mb-2" placeholder="ID Pasien" required>
          <input id="age" type="number" class="form-control mb-2" placeholder="Usia" required>
          <input id="room" class="form-control mb-3" placeholder="Ruangan">
          <button class="btn btn-success w-100">Tambah Pasien</button>
        </form>
      </div>
    </div>

    <!-- MONITOR -->
    <div class="col-md-7">
      <div class="card p-4 text-center">
        <h5 id="monitorName">Belum ada pasien</h5>
        <div id="bpm" style="font-size:4rem;font-weight:bold;">--</div>
        <div id="statusText">Status: Menunggu</div>
        <canvas id="chart" height="100" class="mt-3"></canvas>
      </div>
    </div>

  </div>
</div>

<div class="container">
  <h4>Daftar Pasien</h4>
  <table class="table table-dark table-striped">
    <thead>
      <tr>
        <th>Nama</th><th>ID</th><th>Usia</th><th>Ruangan</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody id="patientList"></tbody>
  </table>
</div>

<footer class="py-4 text-center opacity-75">
  &copy; 2025 | Proyek IoT Kesehatan
</footer>

<script>
  let bpm = 75;
  let timer = null;
  const patients = [];

  const bpmDisplay = document.getElementById('bpm');
  const statusText = document.getElementById('statusText');

  const chart = new Chart(document.getElementById('chart'), {
    type: 'line',
    data: { labels: [], datasets: [{
      data: [],
      borderColor: '#ff4458',
      backgroundColor: 'rgba(255,68,88,0.15)',
      fill: true,
      tension: 0.4
    }]},
    options: {
      plugins: { legend: { display: false }},
      scales: { y: { min: 40, max: 130 }, x: { display: false }}
    }
  });

  function updateBPM() {
    bpm += (Math.random() - 0.5) * 8;
    bpm = Math.round(bpm);

    bpmDisplay.textContent = bpm;

    if (bpm < 60) {
      bpmDisplay.style.color = "var(--warning)";
      statusText.innerHTML = "Status: Bradycardia ‚ö†Ô∏è";
    } else if (bpm > 100) {
      bpmDisplay.style.color = "var(--danger)";
      statusText.innerHTML = "Status: Tachycardia üö®";
    } else {
      bpmDisplay.style.color = "var(--normal)";
      statusText.innerHTML = "Status: Normal ‚úÖ";
    }

    chart.data.labels.push(new Date().toLocaleTimeString());
    chart.data.datasets[0].data.push(bpm);

    if (chart.data.labels.length > 20) {
      chart.data.labels.shift();
      chart.data.datasets[0].data.shift();
    }

    chart.update();
  }

  function addPatient(e) {
    e.preventDefault();
    patients.push({
      name: name.value,
      id: pid.value,
      age: age.value,
      room: room.value || "-"
    });
    e.target.reset();
    renderPatients();
  }

  function renderPatients() {
    patientList.innerHTML = "";
    patients.forEach(p => {
      patientList.innerHTML += `
        <tr>
          <td>${p.name}</td>
          <td>${p.id}</td>
          <td>${p.age}</td>
          <td>${p.room}</td>
          <td>
            <button class="btn btn-sm btn-success"
              onclick="selectPatient('${p.name} (${p.id})')">
              Pantau
            </button>
          </td>
        </tr>`;
    });
  }

  function selectPatient(name) {
    document.getElementById('monitorName').textContent = "Memantau: " + name;
    chart.data.labels = [];
    chart.data.datasets[0].data = [];
    chart.update();

    clearInterval(timer);
    timer = setInterval(updateBPM, 1200);
  }
</script>

</body>
</html>
